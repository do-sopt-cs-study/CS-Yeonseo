# π“ TLS/SSL ν”„λ΅ν† μ½μ μ—­ν• κ³Ό handshake: μ•”νΈν™”λ ν†µμ‹  μ„¤μ • κ³Όμ •

# πΒ SSLκ³Ό TLS

## SSL(Secure Socket Layer) μ •μ

- **μ•”νΈν™” κΈ°λ° μΈν„°λ„· λ³΄μ• ν”„λ΅ν† μ½λ΅, μ „λ‹¬λλ” λ¨λ“  λ°μ΄ν„°λ¥Ό μ•”νΈν™”ν•κ³  νΉμ •ν• μ ν•μ μ‚¬μ΄λ²„ κ³µκ²©λ„ μ°¨λ‹¨ν•λ‹¤.**
- νƒ„μƒ λ°°κ²½ :
  - λ³Έλ μ›Ήμ—μ„μ λ°μ΄ν„°λ” λ„κµ¬λ‚ μ½μ„ μ μλ” μΌλ° ν…μ¤νΈ ν•νƒλ΅ μ „μ†΅ λμ—λ‹¤.
  - μ΄λ¬ν• λ¬Έμ λ΅ μΈν„°λ„· ν†µμ‹ μ κ°μΈμ •λ³΄ λ³΄νΈ, μΈμ¦, λ°μ΄ν„° λ¬΄κ²°μ„±μ΄ λ³΄μ¥μ΄ ν•„μ”ν•΄μ΅λ‹¤.
  - μ΄λ¥Ό μ„ν•΄ Netscapeκ°€ 1995λ…„ μ²μ κ°λ°ν•μ€λ‹¤.
- TLSμ μ „μ‹ μΌλ΅, SSL 3.0 μ΄ν›„ μ—…λ°μ΄νΈ λμ§€ μ•κ³  μ‚¬μ© μ¤‘λ‹¨μ΄ κ¶μ¥λκ³  μλ‹¤.

## TLS(Transport Layer Security)μ μ •μ

- μµμ‹  μ•”νΈν™” ν”„λ΅ν† μ½μ΄λ‹¤.
- **SSLμ μ—…λ°μ΄νΈ λ²„μ „μ΄λ‹¤.** β‡’ SSL μ•”νΈν™”λ΅ νΌμ©ν•΄μ„ λ¶€λ¥΄λ” κ²½μ°λ„ λ§λ‹¤.
  - λ”μ± ν–¥μƒλ, μ•μ „ν• λ²„μ „μ SSLλ΅ TLS μ΄ν›„μ— SSLμ€ μ‚¬μ©λμ§€ μ•λ”λ‹¤.
  - SSL 3.0 (μµμΆ… λ²„μ „)κ³Ό TLSμ μµμ΄ λ²„μ „μ μ°¨μ΄κ°€ ν¬μ§€ μ•λ‹¤.
  - SSLμ μ—…λ°μ΄νΈ λ²„μ „μ΄λ©°, μ†μ κ¶ λ³€κ²½μ μ΄μ λ΅ λ…μΉ­λ§ λ‹¤λ¥΄λ‹¤κ³  λ³Ό μ μλ‹¤.

## **SSL vs TLS (μ •λ¦¬)**

- λ‘λ‹¤ λ³΄μ• ν†µμ‹ μ— μ‚¬μ©λλ” **μ•”νΈν™” ν”„λ΅ν† μ½**μ΄λ‹¤.
- SSLμ€ μ»΄ν“¨ν„° λ„¤νΈμ›ν¬μ—μ„ ν†µμ‹  λ³΄μ•μ„ μ κ³µν•λ” ν”„λ΅ν† μ½μ΄λ‹¤.
- **TLSλ” SSLμ μ—…λ°μ΄νΈ λ²„μ „μ΄λ©° μ¶”κ°€ κ°μΈ μ •λ³΄ λ³΄νΈ λ° λ³΄μ• κΈ°λ¥μΌλ΅ κµ¬μ„±λλ‹¤.**

## TLS/SSLμ΄ ν•λ” κ²ƒ

- TLS/SSL ν”„λ΅ν† μ½μ€ **μ•”νΈν™”, μΈμ¦, λ¬΄κ²°μ„±μ„** κΈ°λ³Έμ μΌλ΅ μ§€μ›ν•λ‹¤.
  - `**μ•”νΈν™”(Encryption)**` : μ  3μλ΅λ¶€ν„° μ „μ†΅λλ” λ°μ΄ν„°λ¥Ό μ¨κΈ΄λ‹¤.
  - `**μΈμ¦(Authentication**)` : μ •λ³΄λ¥Ό κµν™ν•λ” λ‹Ήμ‚¬μκ°€ μ”μ²­λ λ‹Ήμ‚¬μμ„μ„ λ³΄μ¥ν•λ‹¤.
  - **`λ¬΄κ²°μ„±(Integrity)`** : λ°μ΄ν„°κ°€ μ„μ΅°λκ±°λ‚ λ³€μ΅°λμ§€ μ•μ•λ”μ§€ ν™•μΈν•λ‹¤.
- **HTTPS λΏλ§ μ•„λ‹λΌ FTP, XMPP λ“± μ‘μ© κ³„μΈµ(Application Layer) ν”„λ΅ν† **μ½μ μΆ…λ¥μ— μƒκ΄€ μ—†μ΄ μ‚¬μ©ν•  μ μλ‹¤λ” μ¥μ μ΄ μλ‹¤.
  - β“`HTTPS`
    - HTTPλ” HTTP κ³„μΈµ μ•„λμ— TLS/SSLμ΄λΌλ” λ³΄μ• κ³„μΈµμ΄ μ¶”κ°€ λ κ²ƒμΌλ΅, **HTTP λ©”μ‹μ§€μ— ν¬ν•¨λλ” μ½ν…μΈ  μ •λ³΄μ— λ³΄μ• μ”μ†κ°€ μ¶”κ°€λμ–΄ λ°μ΄ν„°λ¥Ό μ•μ „ν•κ² μ£Όκ³  λ°›μ„ μ μλ‹¤.**

---

# πΒ TLS/SSL HandShake

## μ •μ

- HTTPSμ—μ„ ν΄λΌμ΄μ–ΈνΈμ™€ μ„λ²„κ°„μ ν†µμ‹  μ „μ— **TLS/SSL μΈμ¦μ„λ΅ μ‹ λΆ°μ„± μ—¬λ¶€(λ¬΄κ²°μ„±)μ„ ν™•μΈν•κ³  λ€μΉ­ν‚¤λ¥Ό μ „λ‹¬ν•λ” κ³Όμ •**

## TLS/SSL HandShake κ³Όμ •

![Untitled (8)](https://github.com/do-sopt-cs-study/CS-Yeonseo/assets/77691829/3ca1b1fe-d27f-4e24-b4a9-0f592019052d)

- **Step 1 - `Client : Client Hello`**
  - ν΄λΌμ΄μ–ΈνΈλ” μ„λ²„μ—κ²Β **"client hello"**Β λ©”μ‹μ§€λ¥Ό μ•”νΈν™”λ μ •λ³΄μ™€ ν•¨κ» μ „μ†΅ν•λ‹¤.
  - μ΄λ• μ•”νΈν™”λ μ •λ³΄μ—λ”Β **TLS Version, μ•”νΈν™” λ°©μ‹, Client Random Data(Clientκ°€ μƒμ„±ν• λ‚μ, λ€μΉ­ν‚¤ λ§λ“¤ λ• μ‚¬μ©), Session Id, SNI(μ„λ²„λ…)** λ“±μ΄ ν¬ν•¨λλ‹¤.
- **Step 2 - `Server : Server Hello`**
  - μ„λ²„λ” ν΄λΌμ΄μ–ΈνΈκ°€ λ³΄λ‚ΈΒ Client Helloμ— λ€ν•΄ **"server hello"λ©”μ‹μ§€λ΅** ν΄λΌμ΄μ–ΈνΈμ—κ² μ‘λ‹µν•λ‹¤.
  - **TLS Version, μ•”νΈν™” λ°©μ‹(Clientκ°€ λ³΄λ‚Έ μ•”νΈν™” λ°©μ‹ μ¤‘μ— Serverκ°€ μ‚¬μ© κ°€λ¥ν• μ•”νΈν™” λ°©μ‹μ„ μ„ νƒ), Server Random Data(Serverμ—μ„ μƒμ„±ν• λ‚μ, λ€μΉ­ν‚¤λ¥Ό λ§λ“¤ λ• μ‚¬μ©), SessionID(μ ν¨ν• Session ID)**μ΄ ν¬ν•¨λλ‹¤.
- **Step 3 - `Server : Server Certificate`**
  - **μ„λ²„μ μΈμ¦μ„λ¥Ό ν΄λΌμ΄μ–ΈνΈμ—κ² λ³΄λ‚΄λ” λ‹¨κ³„**λ΅ ν•„μ”μ— λ”°λΌ CAμ Certificateλ„ ν•¨κ» μ „μ†΅ν•λ‹¤.
  - ν΄λΌμ΄μ–ΈνΈλ” μ΄ ν¨ν‚·μ„ ν†µν•΄ μ„λ²„μ μΈμ¦μ„κ°€ λ¬΄κ²°ν•μ§€ κ²€μ¦ν•λ‹¤.
- **Step 4 - `Server : Server Hello Done`**
  - μ„λ²„κ°€ ν΄λΌμ΄μ–ΈνΈμ—κ² λ³΄λ‚Ό λ©”μ‹μ§€λ¥Ό λ¨λ‘ λ³΄λƒλ‹¤λ” λ»
- **step 5 - `Client : Client Key Exchange`**
  - `pre-master secret(μ„μ‹ ν‚¤`) :
    - μΈμ¦μ„(CA)κ°€ λ¬΄κ²°ν•μ§€ κ²€μ¦λλ©΄, ν΄λΌμ΄μ–ΈνΈλ” λ³Έκ²©μ μΌλ΅ ν‚¤λ¥Ό μ£Όκ³  λ°›κΈ° μ„ν•΄ μ‹¤μ  λ°μ΄ν„° ν†µμ‹ μ—μ„ μ‚¬μ©λ  μ„μ‹ ν‚¤(pre-master secret)μ„ μƒμ„±ν•λ‹¤.
    - ν΄λΌμ΄μ–ΈνΈλ” ν΄λΌμ΄μ–ΈνΈμ λ‚μμ™€ μ„λ²„μ λ‚μλ¥Ό μ΅°ν•©ν•μ—¬ pre-master seceretμ„ λ§λ“ λ‹¤.
    - μ„μ‹ ν‚¤λ” λ€μΉ­ ν‚¤μ΄κΈ° λ•λ¬Έμ— λ…Έμ¶ λμ–΄μ„λ” μ•λλ” μ •λ³΄μ΄λ‹¤. λ”°λΌμ„ μ•μ„ κ°–κ³  μλ κ³µκ°ν‚¤λ΅ μ•”νΈν™”ν•μ—¬ μ„λ²„μ—κ² μ „λ‹¬λλ‹¤.
- **step 6 - `Server & Client : Change Cipher Spec`**
  - ν‚¤λ¥Ό λ°›μ€ μ„λ²„λ” μμ‹ μ΄ κ°–κ³  μλ **λΉ„λ°€ν‚¤λ΅ λ³µνΈν™”ν•μ—¬ μ„μ‹ ν‚¤(pre-master secret)μ„ μ „λ‹¬ λ°›λ”λ‹¤.**
    β†’ μ΄ λ‹¨κ³„λ¥Ό κ±°μ³ ν΄λΌμ΄μ–ΈνΈμ™€ μ„λ²„κ°€ κ°™μ€ ν‚¤λ¥Ό κ°–κ² λλ‹¤.
  - **μ„Έμ… ν‚¤λ¥Ό μƒμ„±ν•λ‹¤.**
    - ν΄λΌμ΄μ–ΈνΈμ™€ μ„λ²„λ” ν΄λΌμ΄μ–ΈνΈκ°€ μƒμ„±ν• λ¬΄μ‘μ„ ν‚¤, μ„λ²„κ°€ μƒμ„±ν• λ¬΄μ‘μ„ ν‚¤, premaster secret ν‚¤λ¥Ό ν†µν•΄ μ„Έμ… ν‚¤λ¥Ό μƒμ„±ν•λ‹¤.
    - μ–‘μ½μ€ κ°™μ€ ν‚¤κ°€ μƒμ„±λμ–΄μ•Ό ν•λ‹¤.
- **step 7 - `Server & Client : Finished`**

  - **ν΄λΌμ΄μ–ΈνΈ μ¤€λΉ„ μ™„λ£**
    - ν΄λΌμ΄μ–ΈνΈλ” handshake κ³Όμ •μ΄ μ™„λ£λμ—λ‹¤λ” finished λ©”μ‹μ§€λ¥Ό μ„λ²„μ— λ³΄λ‚΄λ©΄μ„, μ§€κΈκΉμ§€ λ³΄λ‚Έ κµν™ λ‚΄μ—­λ“¤μ„ ν•΄μ‹± ν›„ κ·Έ κ°’μ„ λ€μΉ­ν‚¤λ΅ μ•”νΈν™”ν•μ—¬ κ°™μ΄ λ‹΄μ•„ λ³΄λ‚΄μ¤€λ‹¤.
  - **μ„λ²„ μ¤€λΉ„ μ™„λ£**
    - μ„λ²„λ„ λ™μΌν•κ² κµν™ λ‚΄μ©λ“¤μ„ ν•΄μ‹±ν• λ’¤ ν΄λΌμ΄μ–ΈνΈμ—μ„ λ³΄λ‚΄μ¤€ κ°’κ³Ό μΌμΉν•λ” μ§€ ν™•μΈν•λ‹¤. μΌμΉν•λ©΄ μ„λ²„λ„ λ§μ°¬κ°€μ§€λ΅ finished λ©”μ‹μ§€λ¥Ό μ΄λ²μ— λ§λ“  λ€μΉ­ν‚¤λ΅ μ•”νΈν™”ν•μ—¬ λ³΄λ‚Έλ‹¤.
  - ν΄λΌμ΄μ–ΈνΈλ” ν•΄λ‹Ή λ©”μ‹μ§€λ¥Ό λ€μΉ­ν‚¤λ΅ λ³µνΈν™”ν•μ—¬ μ„λ΅ ν†µμ‹ μ΄ κ°€λ¥ν• μ‹ λΆ°λ°›μ€ μ‚¬μ©μλ€ κ±Έ μΈμ§€ν•κ³ , **μ•μΌλ΅ ν΄λΌμ΄μ–ΈνΈμ™€ μ„λ²„λ” ν•΄λ‹Ή λ€μΉ­ν‚¤λ΅ λ°μ΄ν„°λ¥Ό μ£Όκ³ λ°›μ„ μ μκ² λλ‹¤.**
    β‡’ SSL/TLS Handshakeλ¥Ό μ„±κ³µμ μΌλ΅ λ§μΉκ³  μΆ…λ£ν•λ‹¤.
    β‡’ μ΄ν›„ μ„Έμ…ν‚¤λ¥Ό μ‚¬μ©ν•΄ λ€μΉ­ν‚¤ κΈ°λ²•μΌλ΅ ν†µμ‹ μ΄ κ³„μ†λλ‹¤.
    β‡’ λ°μ΄ν„° μ „μ†΅μ΄ λλ‚λ©΄ μ„Έμ…μ„ μΆ…λ£ν•΄ ν†µμ‹ μ„ λ§μΉκ³ , ν†µμ‹ μ—μ„ μ‚¬μ©ν• μ„Έμ… ν‚¤λ„ ν•¨κ» μ‚­μ ν•λ‹¤.

- μ¶μ²

https://brunch.co.kr/@swimjiy/47

https://kanoos-stu.tistory.com/46

https://velog.io/@yuseogi0218/TLS-SSL-HandShake

https://www.cloudflare.com/ko-kr/learning/ssl/what-happens-in-a-tls-handshake/
