# 📚 로드 밸런싱(Load Balancing): 서버 부하 분산 기술

# 🌟 1. 로드밸런싱의 정의 및 필요성

## ❓ (1) 로드밸런싱의 정의

### `로드밸런싱(Load Balancing)이란?`

- **둘 혹은 셋 이상의 중앙 처리 장치 혹은 저장 장치와 같은 컴퓨터 자원들에게 작업(=부하)을 나누는 네트워크 기술**
- 즉, 여러 서버로 분산 처리 하는 기술

### `로드밸런서(Load Balancer)란?`

![Untitled (10)](https://github.com/do-sopt-cs-study/CS-Yeonseo/assets/77691829/e00fe537-f0f9-40ef-a019-1c697dd2f58f)

- 서버에 가해지는 부하를 분산 해주는, 로드밸런싱 기술을 제공하는 장치 또는 기술
- **client와 Server Pool(분산 네트워크를 구성하는 서버들의 그룹) 사이에 위치하여**, 한 대의 서버로 부하가 집중되지 않도록 트래픽을 관리하여 서버가 최적의 퍼포먼스를 보일 수 있도록 한다.

## ❓(2) 로드밸런싱의 필요성

### `Scale Up vs Scale Out`

![Untitled (11)](https://github.com/do-sopt-cs-study/CS-Yeonseo/assets/77691829/cedd6db9-3c28-40a7-a7b7-2f1cbcd508fb)

사업 규모의 확장 및 클라이언트 수의 증가 등 기존 한 대의 서버만을 정상적인 서비스가 불가능하게 되면, **증가한 트래픽에 대처할 수 있는 방법**에는 크게 두 가지가 있다.

1. `Scale-Up` : 서버 자체의 성능을 확장하는 것.
   - ex. CPU가 i3인 컴퓨터를 i7으로 업그레이드 하는 것
2. `Scale-Out` : 기존 서버와 동일하거나 낮은 성능의 서버를 두 대 이상 증설하여 운영하는 것.

   - ex. CPU가 i3인 컴퓨터를 여러 대 추가 구입해 운영하는 것

   ⇒ Scale-Out 방식으로 서버를 증설하기로 결저아였다면, **여러 대의 서버로 트래픽을 균등하게 분산해주는 로드밸런싱이 반드시 필요하다!**

## ❓(3) 로드밸런싱의 장점

- 1. **`애플리케이션 가용성`**
  - 로드밸런싱을 사용하면 서버 문제를 자동으로 감지하고 클라이언트 트래픽을 사용 가능한 서버로 리다이렉션하여 시스템의 내결함성을 높인다.
  - 즉, 서버 장애에 대해 자동 재해 복구를 제공하고 가동 중지 없이 서버를 유지 관리 및 업그레이드할 수 있어 애플리케이션의 가용성을 향상시킬 수 있다.
- 2. `**애플리케이션 확장성**`
  - 로드밸런싱을 사용하여 여러 서버 간 네트워크 트래픽을 지능적으로 전달할 수 있다.
- 3. `**애플리케이션 보안**`
  - 로드밸런싱에는 인터넷 애플리케이션에 또 다른 보안 계층을 추가할 수 있는 보안 기능이 내장되어 있다.
  - 로드밸런싱을 사용하면 트래픽 모니터링 및 악성 콘텐츠를 차단하고, 추가 보안을 위해 네트워크 방화벽 그룹을 통해 트래픽 라우팅을 할 수 있어 보안이 향상된다.
- 4. **`애플리케이션 성능`**
  - 로드밸런싱을 사용하면 로드를 균등하게 배포할 수 있어 응답 시간을 늘리고 네트워크 지연 시간을 줄여 애플리케이션 성능이 향상된다.

<br/>

---

# 🌟 2. 로드밸런싱 알고리즘

### `정적 로드밸런싱`

**현재 서버 상태와 무관하게 고정된 규칙을 따르는 로드밸런싱 알고리즘**의 종류

- 1. `라운드 로빈 방식(Round Robin Method)`
  - **서버에 들어온 요청을 순서대로 돌아가며 배정하는 방식**
  - 클라이언트의 요청을 순서대로 분배하기 때문에 여러 대의 서버가 동일한 스펙을 갖고 있고, 서버와의 연결이 오래 지속되지 않은 경우에 활용하기 적합하다.
- 2. `가중 라운드 로빈 방식(Weighted Round Robin Method)`
  - **각각의 서버마다 가중치를 매기고 가중치가 높은 서버에 클라이언트 요청을 우선적으로 배분하는 방식**
  - 주로 서버의 트래픽 처리 능력이 상이한 경우 사용되는 부하 방식이다.
    - ex) ‘_A 서버’의 가중치 = 5 / ‘B 서버’의 가중치 = 2 일때_
      ⇒ 로드밸런서는 라운드 로빈 방식으로 A 서버에 5개, B 서버에 2개의 요청을 전달한다.
- 3. `IP 해시 방식(IP Hash Method)`
  - **클라이언트의 IP 주소를 특정 서버로 매핑하여 요청을 처리하는 방식**
  - 사용자의 IP를 해싱해 로드를 배분하기 때문에 사용자가 항상 동일한 서버로 연결 되는 것을 보장한다는 장점이 있다.
    - _해싱? 임의의 길이를 지닌 데이터를 고정된 길이의 데이터로 매핑 하는 함수, 기술_

### `동적 로드밸런싱`

트래픽을 배포하기 전 **서버의 현재 상태를 검사하는 로드밸런싱 알고리즘**의 종류

- 1. `최소 연결 방식(Least Connection Method)`
  - **요청이 들어온 시점에 가장 적은 연결 상태를 보이는 서버에 우선적으로 트래픽을 배분하는 방식**
  - 자주 세션이 길어지거나, 서버에 분배된 트래픽들이 일정하지 않은 경우에 적합하다.
- 2. `최소 응답 시간 방식(Least Response Time Method)`
  - **서버의 현재 연결 상태와 응답시간을 모두 고려하여 트래픽을 배분하는 방식**
  - 가장 적은 연결 상태와 가장 짧은 응답시간을 보이는 서버에 우선적으로 로드를 배분한다.

<br/>

---

# 🌟 3. 로드밸런서 종류

로드밸런서의 종류는 OSI 7계층를 기준으로 어떻게 부하를 분산하는지에 따라 종류가 나뉜다.

- L1 ~ L7까지 다양한 계층이 존재하고, 상위 계층에서 사용하는 장비는 하위 계층의 기능을 모두 가지고 있고 상위 계층으로 갈수록 섬세한 로드밸런싱이 가능한만큼 비용도 비싸진다.
- 특히, **이 중 L4, L7 로드 밸런서를 가장 많이 사용한다**.
  - L4 로드밸런서부터 포트 정보를 바탕으로 로드를 분산 가능하기 때문에, L4 로드밸런서 이상부터 많이 사용한다.

### **`L4 로드밸런서`**

![Untitled (12)](https://github.com/do-sopt-cs-study/CS-Yeonseo/assets/77691829/f13d01f1-199b-40b5-b9dd-f0171b982972)

- 네트워크 계층(IP, IPX)이나 트랜스포트 계층(TCP, UDP)의 정보를 바탕으로 로드를 분산한다.
- IP 주소나 포트번호, MAC 주소, 전송 프로토콜에 따라 트래픽을 나누는 것이 가능하다.
- 장점 :
  - 패킷의 내용을 확인하지 않고 로드를 분산하므로 속도가 빠르고 효율이 높다
    ⇒ L7 로드밸런서보다 가격이 저렴하다
  - 데이터의 내용을 복호화할 필요가 없기에 안전하다
- 단점 :
  - 패킷의 내용을 살펴볼 수 없으므로, 섬세한 라우팅이 불가능하다.
  - 사용자의 IP가 수시로 바뀌는 경우라면, 연속적인 서비스를 제공하기 어렵다.

### `L7 로드밸런서`

![Untitled (13)](https://github.com/do-sopt-cs-study/CS-Yeonseo/assets/77691829/b24a07b1-e5b6-48a7-9d30-c655f0696056)

- 애플리케이션 계층(HTTP, FTP, SMTP)에서 로드를 분산하기 때문에 HTTP 헤더, 쿠기 등과 같은 사용자의 요청을 기준으로 특정 서버에 트래픽을 분산하는 것이 가능하다.
- 즉, 패킷의 내용을 확인하고 그 내용에 따라 로드를 특정 서버에 분배하는 것이 가능하다.
- 특정한 패턴을 지닌 바이러스를 감지해 네트워크를 보호할 수 있으며, DoS/DDos와 같은 비정상적인 트래픽을 필터링 할 수 있다.
  → 네트워크 보안 분야에서도 활용되고 있다.
- 장점 :
  - 상위 계층에서 로드를 분산하기 때문에 훨씬 더 섬세한 라우팅이 가능하다
  - 캐싱(Cashing)기능을 제공한다.
  - 비정상적인 트래픽을 사전에 필터링 할 수 있어 서비스 안정성이 높다
- 단점 :
  - 패킷의 내용을 복호화하여야 하므로 더 높은 비용을 지불해야 한다. (L4 로드밸런서에 비해 비싸다)
  - 클라이언트가 로드밸런서와 인증서를 공유해야 하기 때문에, 공격자가 로드밸런서를 통해 클라이언트의 데이터에 접근할 수 있는 보안상의 위험성도 존재한다.

---

출처

https://m.post.naver.com/viewer/postView.naver?volumeNo=27046347&memberNo=2521903

https://aws.amazon.com/ko/what-is/load-balancing/

[https://velog.io/@yanghl98/OS운영체제-로드밸런싱-Load-Balancing-정의-종류-알고리즘](https://velog.io/@yanghl98/OS%EC%9A%B4%EC%98%81%EC%B2%B4%EC%A0%9C-%EB%A1%9C%EB%93%9C%EB%B0%B8%EB%9F%B0%EC%8B%B1-Load-Balancing-%EC%A0%95%EC%9D%98-%EC%A2%85%EB%A5%98-%EC%95%8C%EA%B3%A0%EB%A6%AC%EC%A6%98)
