# 📚 인터럽트(Interrupt)와 시스템 콜(System Call): 입출력 및 예외 처리

## 🌟 인터럽트(Interrupt)

### 1. 인터럽트란?

- 프로그램을 실행하는 도중에 예기치 않은 상황이 발생할 경우 현재 실행 중인 작업을 즉시 중단하고, 발생된 상황에 대한 우선 처리가 필요함을 CPU에게 알리는 것
- 지금 수행 중인 일보다 더 중요한 일(ex. 입출력, 우선 순위 연산 등)이 발생하면 그 일을 먼저 처리하고 나서 하던 일을 계속해야 한다.

### 2. 인터럽트의 종류

> **외,내부 인터럽트**는 CPU의 하드웨어 신호에 의해 발생하며 / **소프트웨어 인터럽트**는 명령어의 수행에 의해 발생한다.

- `외부 인터럽트`
  - 입출력 장치, 타이밍 장치, 전원 등 외부적인 요인으로 발생
  - _ex. 전원 이상, 기계 착오, 외부 신호, 입출력_
- `내부 인터럽트`
  - **Trap**이라고도 부르며, 잘못된 명령이나 데이터를 사용할 때 발생
  - _ex. 0으로 나누기가 발생, 오버플로우, 명령어를 잘못 사용한 경우(Exception)_
- `소프트웨어 인터럽트`
  - 프로그램 처리 중 명령의 요청에 의해 발생한 것 (SVC 인터럽트)
  - 소프트웨어 이용 중에 다른 프로세스를 실행시키면 시분할 처리를 위해 자원 할당 동작이 수행된다.
  - _ex. 사용자가 프로그램을 실행 시킬 때 발생_

### 3. 인터럽트의 동작 과정

1. `프로그램 실행 중단` : 현재 실행중이던 명령어까지 수행한다.
2. `현재의 프로그램 상태 보존` : 인터럽트 종료 후 PC(Program Counter)의 값을 스택에 저장한다.
3. `인터럽트 처리 루틴 실행` : 인터럽트를 요청한 장치를 식별한다.
4. `인터럽트 서비스 루틴(ISR) 실행` :
   - ISR 처리하기 전, 현재 수행하던 작업을 스택에 저장하는데, 이것을 Context를 저장한다고 한다.
     - Context : 프로세스 상태와 관련된 레지스터의 집합
   - 인터럽트 원인을 파악하고 실질적인 작업을 수행한다.
   - 처리기 레지스터 상태를 보존한다.
   - 서비스 루틴 수행 중 우선 순위가 더 높은 인터럽트가 발생하면 또 재귀적으로 위 과정을 수행
5. `상태 복구` : 인터럽트 발생 시 저장해둔 PC(Program Counter)를 다시 복구한다.
6. `중단된 프로그램 실행 재개` : PC의 값을 이용하여 이전에 수행중이던 프로그램을 제게한다.

### 4. 폴링 vs 인터럽트

컨트롤러가 입력을 받아들이는 방법(우선순위 판별 방법)에는 폴링, 인터럽트의 두 가지가 있다.

1. `폴링 방식`
   - 사용자가 명령어를 사용해 입력 핀의 값을 계속 읽어 변화를 알아내는 방식
   - 인터럽트 요청 플래그를 차례로 비교하여 우선순위가 가장 높은 인터럽트 자원을 찾아 이에 맞는 인터럽트 서비스 루틴을 수행한다.
   - 하드웨어에 비해 속도가 느리다.
   - 폴링을 하는 시간에는 컨트롤러가 특정한 어떤 일을 할 시기를 알기 위해 계속 체크를 해야 하고, 원래 하던 일에 집중할 수가 없게 되어 많은 기능을 제대로 수행하지 못하는 단점이 있다.
2. `인터럽트 방식`
   - MCU 자체가 하드웨어적으로 변화를 체크하여 변화 시에만 일정한 동작을 하는 방식
     → **발생시기를 예측하기 힘든 경우에 컨트롤러가 가장 빠르게 대응할 수 있는 방법**
   - Daisy Chain
   - 병렬 우선순위 부여
   - 인터럽트 방식은 하드웨어로 지원을 받아야 하는 제약이 있지만, 폴링에 비해 신속하게 대응하는 것이 가능하다는 장점이 있다
     → **실시간 대응**이 필요할 때는 필수적인 기능이다.

---

## 🌟 시스템 콜 (System Call)

![Untitled (10)](https://github.com/do-sopt-cs-study/CS-Yeonseo/assets/77691829/520df7bc-5b88-4dd9-839e-e38ebe6ba78b)

### 1. 시스템 콜(시스템 호출, system call)이란?

- 운영체제의 커널이 제공하는 서비스에 대해, **응용 프로그램의 요청에 따라 커널에 접근하기 위한 인터페이스**
- 용자 프로그램이 특권 명령의 수행을 필요로 하는 경우, 운영체제에게 특권 명령의 대행을 요청하는 것이 시스템 콜이다.
  - ex.사용자 프로그램이 디스크 파일을 접근하거나 결과를 출력하는 등의 작업이 필요한 경우.

### 2. 시스템 콜의 기능

1. 사용자 모드에 있는 응용 프로그램이 커널의 기능을 사용할 수 있도록 한다.
2. 시스템 호출을 하면 사용자 모드에서 커널 모드로 바뀐다.
3. 커널에서 시스템 호출의 작업이 끝나면 사용자 모드로 돌아간다.

### 3. 시스템 콜이 필요한 이유?

- 사용자가 직접적으로 하드웨어 장치를 제어한다면 큰 문제가 발생할 수 있기 때문이다.
  → 따라서 사용자 어플리케이션은 시스템 콜을 통해 직접적인 하드웨어 요청이나 중요한 시스템 요청을 한다.
- **유저레벨**의 응용프로그램은 유저레벨의 함수들 만으로는 많은 기능을 구현하기 힘들기 때문에 커널의 도움을 반드시 받아야 한다.
- **커널에** 관련된 것은 커널모드로 전환된 후에야 해당 작업을 수행할 권한이 생긴다. **커널모드**를 통한 이러한 작업은 반드시 시스템 콜을 통해 수행하도록 설계되어 있다

### 4. 시스템 콜의 유형

(1) `프로세스 컨트롤`

- 프로세스 생성 및 종료
- 메모리에 로드, 실행
- 프로세스 속성 값 확인, 지정
- wait 이벤트, signal 이벤트
- 메모리 할당

⇒ ex) fork, wait, exec 등

(2) `파일 매니지먼트`

- 파일 생성, 파일 삭제
- 열기, 닫기
- 읽기, 쓰기, Reposition
- 파일 속성 값 확인, 지정

=> ex) open, read, write, close 등

(3) `디바이스 매니지먼트`

- 디바이스 요청 및 해제
- 읽기, 쓰기, Reposition
- 디바이스 속성 확인, 지정
- 비 물리적인 디바이스 해제 및 장착

(4) `정보 관리`

- 시간 확인, 시간 지정
- 시스템 데이터 확인, 지정
- 프로세스, 파일, 디바이스 속성 가져오기
- 프로세스, 파일, 디바이스 속성 설정하기

(5) `통신`

- 커뮤니케이션 연결 생성 및 삭제
- 메시지 송신, 수신
- 상태 정보 전달
- remote 디바이스 해제 및 장착

(6) `보안`

- Permission 획득
- Permission 설정
