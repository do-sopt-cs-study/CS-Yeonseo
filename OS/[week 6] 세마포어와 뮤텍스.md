# 📚 공유 자원 동기화 메커니즘 : 세마포어(Semaphore)와 뮤텍스(Mutex)

## 🌟 1. 공유 자원 동기화 메커니즘의 필요성

### (1) 임계 구역(Critical Section)

- 공유 자원에 접근할 때 순서 등의 이유로 **결과가 달라지는 영역**

⇒ 이렇게 임계 구역에 여러 프로세스, 스레드가 함부로 접근할 수 없도록 관리를 잘 해줘야 하는데, 이를 위해 공유자원 동기화 메커니즘인 세마포어와 뮤텍스 등의 방식을 사용한다.

---

## 🌟 2. 뮤텍스(Mutex)

![Untitled (14)](https://github.com/do-sopt-cs-study/CS-Yeonseo/assets/77691829/1466a42f-0992-499c-957e-7e470bc5f30c)

### (1) 뮤텍스(Mutex)란 ?

- 임계 구역을 가진 스레드들의 실행시간이 서로 겹치지 않고 각각 단독으로 실행되게 하는 기술
- 상호 배제(**Mu**tual **Ex**clusion의 약자!)라고도 하며, Critical Section을 가진 스레드의 Running time이 서로 겹치지 않도록 각각 단독으로 실행하게 하는 기술이다.
- 다중 프로세스들의 공유 리소스에 대한 접근을 조율하기 위해 동기화(synchronized) 또는 lock을 사용한다.
  ⇒ 즉, 뮤텍스 객체를 두 스레드가 동시에 사용할 수 없다.
  - ex. lock 사용
    - **lock** : 현재 임계 구역에 들어갈 권한을 얻어온다. → 만약 다른 프로세스/스레드가 임계 구역에서 수행 중이면 종료 할 때까지 대기한다.
    - **unlock** : 현재 임계 구역을 모두 사용했음을 알린다.→ 대기 중인 다른 프로세스/스레드가 임계 구역에 진입할 수 있다.
- 뮤텍스는 **상태가 0, 1로 이진 세마포어**로 부르기도 한다.

### (2) Mutex 과정

뮤텍스는 Key 에 해당하는 어떤 오브젝트가 있으며 이 오브젝트를 소유한 스레드,프로세스만이 공유자원에 접근할 수 있다.

- 1번 프로세스가 자원을 접근하기 위해 Key를 점유한다.
- 1번 프로세스는 키를 점유했기 때문에 공유 자원을 사용한다.
- 2번 프로세스가 공유 자원을 사용하기를 원한다.
- 2번 프로세스는 키를 점유하기 위해 대기한다.
- 3번 프로세스 또한 공유 자원을 사용하기 위해 2번 프로세스 다음 순번으로 대기한다.
- 1번 프로세스가 공유 자원을 다 사용하고 Key를 반환한다.
- 2번 프로세스는 대기하고 있다가 반환된 Key를 점유하고 공유 자원을 사용한다.

---

## 🌟 3. 세마포어(Semaphore)

![Untitled (15)](https://github.com/do-sopt-cs-study/CS-Yeonseo/assets/77691829/f1ea3fbd-bb25-4b92-8f07-2206bf09e607)

### (1) 세마포어(Semaphore)란?

- 멀티 프로그래밍 환경에서 공유된 자원의 데이터를 `여러 프로세스가` **접근하는 것을 막는 것**
- **리소스 상태를 나타내는 간단한 카운터**라고 생각할 수 있다.
  - 운영체제 또는 커널의 한 지정된 저장장치 내의 값이다.
  - 일반적으로 비교적 긴 시간을 확보하는 리소스에 대해 이용한다
  - 유닉스 시스템 프로그래밍에서 세마포어는 운영체제의 리소스를 경쟁적으로 사용하는 다중 프로세스에서 행동을 조정하거나 또는 동기화 시키는 기술이다.
- 공유 리소스에 접근할 수 있는 프로세스의 최대 허용치만큼 동시에 사용자가 접근하여 사용할 수 있다.
- 각 프로세스는 세마포어 값은 확인하고 변경할 수 있다.
  - 사용 중이지 않는 자원의 경우 그 프로세스가 즉시 자원을 사용할 수 있다.
  - 이미 다른 프로세스에 의해 사용 중이라는 사실을 알게 되면 재시도하기 전에 일정 시간을 기다려야 한다.
  - 세마포어를 사용하는 프로세스는 그 값을 확인하고, 자원을 사용하는 동안에는 그 값을 변경함으로써 다른 세마포어 사용자들이 기다리도록 해야한다.
- 세마포어는 이진수 (0 또는 1)를 사용하거나, 또는 추가적인 값을 가질 수도 있다.

### (2) 세마포어 과정

세마포어는 공유 리소스에 접근할 수 있는 최대 허용치 만큼 동시 사용자 스레드, 프로세스의 접근을 허용하게 한다.

- 공유 자원에 대한 최대 허용치를 정의한다. (최대 허용치가 3이라고 가정하자.)
- 1번 프로세스가 공유 자원에 접근한다. 허용치는 2로 감소하였다.
- 2번 프로세스가 공유 자원에 접근한다. 허용치는 1로 감소하였다.
- 3번 프로세스가 공유 자원에 접근한다. 허용치는 0로 감소하였다.
- 4번 프로세스가 공유 자원에 접근한다. 허용치가 0이므로 대기한다.
- 2번 프로세스가 공유 자원을 다 사용하였다. 허용치는 1로 증가하였다.
- 4번 프로세스는 대기 하다 허용치가 1로 증가되어 공유 자원에 접근한다. 허용치는 다시 0으로 감소하였다.

---

## 🌟 4. 뮤텍스 vs 세마포어

- 가장 큰 차이점 : 동기화 대상의 개수
  - 뮤텍스 : 동기화 대상이 오직 하나 뿐일 때 사용
  - 세마포어 : 동기화 대상이 하나 이상일 때 사용
- 세마포어는 뮤텍스가 될 수 있지만, 뮤텍스는 세마포어가 될 수 없다.
  - 뮤텍스는 0, 1 상태가 두개 뿐인 이진 세마포어
  - 세마포어는 뮤텍스에 근간을 이루고 있다.
- 세마포어는 소유할 수 없는 반면, 뮤텍스는 소유가 가능하며 소유주가 이에 대한 책임을 가진다.
  - 뮤텍스의 경우 상태가 두 개 뿐인 lock이므로 lock을 가질 수 없다.
- 뮤텍스의 경우 뮤텍스를 소유하고 있는 스레드가 이 뮤텍스를 해제할수 있다.
  하지만 세마포어의 경우 세마포어를 소유하지 않는 스레드가 세마포어를 해지할 수 있다.
- 세마포어는 시스템 범위에 걸쳐 있고 파일 시스템의 파일 형태로 존재한다.
  하지만 뮤텍스는 프로세스 범위를 가지며 프로세스가 종료 될 때 자동으로 clean up 된다.
